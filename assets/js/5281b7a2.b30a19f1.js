"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2443],{936(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"architecture","title":"Architecture","description":"Date @retr0h","source":"@site/docs/architecture.md","sourceDirName":".","slug":"/architecture","permalink":"/gilt/next/architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"docsSidebar","previous":{"title":"Development","permalink":"/gilt/next/development"}}');var o=i(4848),s=i(8453);const t={sidebar_position:8},c="Architecture",l={},d=[{value:"Overview",id:"overview",level:2},{value:"High-Level Flow",id:"high-level-flow",level:2},{value:"Package Details",id:"package-details",level:2},{value:"<code>cmd/</code>",id:"cmd",level:3},{value:"<code>internal/</code>",id:"internal",level:3},{value:"<code>pkg/</code>",id:"pkg",level:3},{value:"<code>test/integration/</code>",id:"testintegration",level:3},{value:"<code>docs/</code>",id:"docs",level:3},{value:"<code>python/</code>",id:"python",level:3},{value:"Design Patterns",id:"design-patterns",level:2},{value:"Interface Segregation",id:"interface-segregation",level:3},{value:"Dependency Injection",id:"dependency-injection",level:3},{value:"Filesystem Abstraction",id:"filesystem-abstraction",level:3},{value:"Configuration Layering",id:"configuration-layering",level:3}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Date:"})," February 2026 ",(0,o.jsx)(n.strong,{children:"Author:"})," @retr0h"]}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"Gilt is a repository overlay tool. It clones Git repositories at pinned versions\n(tags or SHAs), then copies specific files or directories into a target project.\nThis enables vendoring configuration, schemas, or shared code from upstream\nrepositories without Git submodules."}),"\n",(0,o.jsx)(n.h2,{id:"high-level-flow",children:"High-Level Flow"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Giltfile.yaml\n     \u2502\n     v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  pkg/repositories       \u2502  Public API entry point\n\u2502  Overlay()              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  internal/repositories  \u2502  Iterates configured repos (serial or parallel)\n\u2502  Overlay()              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  internal/repository    \u2502  Per-repo: clone, worktree, copy sources\n\u2502  Clone() / Worktree()   \u2502\n\u2502  CopySources()          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  internal/git           \u2502  Shells out to git CLI\n\u2502  Clone() / Worktree()   \u2502  (bare clone, worktree checkout)\n\u2502  Update() / Remote()    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  internal/exec          \u2502  Command execution abstraction\n\u2502  RunCmd()               \u2502\n\u2502  RunCmdInDir()          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(n.h2,{id:"package-details",children:"Package Details"}),"\n",(0,o.jsx)(n.h3,{id:"cmd",children:(0,o.jsx)(n.code,{children:"cmd/"})}),"\n",(0,o.jsx)(n.p,{children:"Cobra CLI commands. Entry points for user interaction."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"root.go"})," - Root command, Viper config binding"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"overlay.go"})," - ",(0,o.jsx)(n.code,{children:"gilt overlay"})," command, reads Giltfile and runs the overlay"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"init.go"})," - ",(0,o.jsx)(n.code,{children:"gilt init"})," command, scaffolds a new Giltfile"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"version.go"})," - ",(0,o.jsx)(n.code,{children:"gilt version"})," command"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"internal",children:(0,o.jsx)(n.code,{children:"internal/"})}),"\n",(0,o.jsxs)(n.p,{children:["Interface definitions live at the package root (",(0,o.jsx)(n.code,{children:"git.go"}),", ",(0,o.jsx)(n.code,{children:"exec.go"}),",\n",(0,o.jsx)(n.code,{children:"repository.go"}),", ",(0,o.jsx)(n.code,{children:"repositories.go"}),"). Implementations live in sub-packages."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"git/"})})," - Git CLI wrapper. Performs bare clones, worktree checkouts, remote\nURL lookups, and repository updates by shelling out to ",(0,o.jsx)(n.code,{children:"git"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"exec/"})})," - Command execution abstraction. Wraps ",(0,o.jsx)(n.code,{children:"os/exec"})," with working\ndirectory support and temp directory helpers."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"repository/"})})," - Single repository operations. Orchestrates clone, worktree\ncheckout, and file/directory copying for one repository entry."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"repositories/"})})," - Multi-repository orchestrator. Reads the Giltfile,\niterates all configured repositories, and delegates to ",(0,o.jsx)(n.code,{children:"repository/"}),". Supports\nparallel execution."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"path/"})})," - Path utility functions."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"mocks/"})})," - Generated mock implementations (via ",(0,o.jsx)(n.code,{children:"mockgen"}),") for all\ninterfaces. Used in unit tests."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"pkg",children:(0,o.jsx)(n.code,{children:"pkg/"})}),"\n",(0,o.jsx)(n.p,{children:"Public API surface."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"config/"})})," - Configuration types (",(0,o.jsx)(n.code,{children:"Repositories"}),", ",(0,o.jsx)(n.code,{children:"Repository"}),", ",(0,o.jsx)(n.code,{children:"Source"}),",\n",(0,o.jsx)(n.code,{children:"Command"}),"). Uses Viper for binding and ",(0,o.jsx)(n.code,{children:"go-playground/validator"})," for schema\nvalidation."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"repositories/"})})," - Public entry point. Wires together internal components\nand exposes ",(0,o.jsx)(n.code,{children:"Overlay()"})," to external consumers."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"testintegration",children:(0,o.jsx)(n.code,{children:"test/integration/"})}),"\n",(0,o.jsxs)(n.p,{children:["Bats integration tests that exercise the full ",(0,o.jsx)(n.code,{children:"gilt overlay"})," flow against real\nGit repositories."]}),"\n",(0,o.jsx)(n.h3,{id:"docs",children:(0,o.jsx)(n.code,{children:"docs/"})}),"\n",(0,o.jsxs)(n.p,{children:["Docusaurus documentation site (Markdown content in ",(0,o.jsx)(n.code,{children:"docs/docs/"}),")."]}),"\n",(0,o.jsx)(n.h3,{id:"python",children:(0,o.jsx)(n.code,{children:"python/"})}),"\n",(0,o.jsx)(n.p,{children:"Python wheel packaging scripts for distributing Gilt via PyPI."}),"\n",(0,o.jsx)(n.h2,{id:"design-patterns",children:"Design Patterns"}),"\n",(0,o.jsx)(n.h3,{id:"interface-segregation",children:"Interface Segregation"}),"\n",(0,o.jsxs)(n.p,{children:["Small, focused interfaces are defined in ",(0,o.jsx)(n.code,{children:"internal/*.go"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"GitManager"})," - Git operations (clone, worktree, update, remote)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ExecManager"})," - Command execution (run, run-in-dir, run-in-temp-dir)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"RepositoryManager"})," - Single repo operations (clone, worktree, copy)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"RepositoriesManager"})," - Multi-repo orchestration (overlay)"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"dependency-injection",children:"Dependency Injection"}),"\n",(0,o.jsxs)(n.p,{children:["Implementations accept their dependencies via constructors. For example,\n",(0,o.jsx)(n.code,{children:"git.New()"})," takes an ",(0,o.jsx)(n.code,{children:"ExecManager"}),", and ",(0,o.jsx)(n.code,{children:"repository.New()"})," takes both a\n",(0,o.jsx)(n.code,{children:"GitManager"})," and ",(0,o.jsx)(n.code,{children:"ExecManager"}),". This makes testing straightforward with\ngenerated mocks."]}),"\n",(0,o.jsx)(n.h3,{id:"filesystem-abstraction",children:"Filesystem Abstraction"}),"\n",(0,o.jsxs)(n.p,{children:["The project uses ",(0,o.jsx)(n.a,{href:"https://github.com/avfs/avfs",children:(0,o.jsx)(n.code,{children:"avfs"})})," for filesystem\noperations, enabling tests to run against in-memory filesystems."]}),"\n",(0,o.jsx)(n.h3,{id:"configuration-layering",children:"Configuration Layering"}),"\n",(0,o.jsxs)(n.p,{children:["Viper binds CLI flags, environment variables, and the Giltfile (YAML) into typed\n",(0,o.jsx)(n.code,{children:"config.Repositories"})," structs. Validation is handled by\n",(0,o.jsx)(n.code,{children:"go-playground/validator"})," struct tags."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>t,x:()=>c});var r=i(6540);const o={},s=r.createContext(o);function t(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);